<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>lazzzis</title>
  <link rel="icon" href="favicon.ico"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/css/ionicons.min.css">
  <link rel="stylesheet" href="/css/milligram.min.css">
  <link rel="stylesheet" href="/css/comfortaa.css">
  <link rel="stylesheet" href="/css/source-sans-pro.css">
  <link rel="stylesheet" href="/css/animate.min.css">
  <link rel="stylesheet" href="/css/nprogress.css">
  <link rel="stylesheet" href="/css/loaders.min.css">
  <link rel="stylesheet" href="/css/atom-one-light.css">
  <link rel="stylesheet" href="/css/app.css">
</head>
<body>
  <div id="app"></div>
  <template>
    <template>
    <p>Python 对函数默认参数的处理</p>
<p>一个以可变对象为默认参数的函数:</p>

    <pre><code class="lang-Python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.x = <span class="hljs-number">1</span>
        print(<span class="hljs-string">'created'</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span><span class="hljs-params">(a = A<span class="hljs-params">()</span>)</span>:</span>
    a.x += <span class="hljs-number">1</span>
    print(a.x)
<span class="hljs-comment"># output: created</span>
f() <span class="hljs-comment"># output: 2</span>
f() <span class="hljs-comment"># output: 3</span>
</code></pre>
<p>从结果可以看出，Python 在解析时便已经创建好了默认参数 a 的值。函数 f 在调用时采用了同一个对象，而不是每次调用时重新创建新的对象。这一点与 <code>C++</code> 的处理方式不同。</p>
<a id="more"></a>
<h1 id="f-defaults"><a href="#f-defaults" class="headerlink" title="f.__defaults__"></a><code>f.__defaults__</code></h1><p>在 Python 中，函数属于一等公民(first-class)。函数可当作一个对象，拥有自己的属性与方法。而默认参数则存在与函数的一个属性中。</p>

    <pre><code class="lang-Python"><span class="hljs-selector-tag">In</span> <span class="hljs-selector-attr">[28]</span>: <span class="hljs-selector-tag">def</span> <span class="hljs-selector-tag">f</span>(a, b=<span class="hljs-number">1</span>):
       <span class="hljs-selector-tag">2</span>     <span class="hljs-selector-tag">pass</span>


<span class="hljs-selector-tag">In</span> <span class="hljs-selector-attr">[29]</span>: <span class="hljs-selector-tag">f</span><span class="hljs-selector-class">.__defaults__</span>
<span class="hljs-selector-tag">Out</span><span class="hljs-selector-attr">[29]</span>: (<span class="hljs-number">1</span>, [])
</code></pre>
<p>Python 在解析代码时，便会将默认参数存于 <code>f.__defaults__</code> 中。</p>
<p>在 CPython 的 (funcobject.h)[<a href="https://github.com/python/cpython/blob/master/Include/funcobject.h]" target="_blank" rel="noopener">https://github.com/python/cpython/blob/master/Include/funcobject.h]</a> 中也可以看到，<code>PyFunctionObject</code> 的一个属性便是 <code>func_defaults</code>, 对应 Python 中每个函数中的 <code>__defaults__</code> 属性</p>
<h1 id="默认参数-与-闭包"><a href="#默认参数-与-闭包" class="headerlink" title="默认参数 与 闭包"></a>默认参数 与 闭包</h1><p>以下是一个经常被提起的关于理解闭包的一段代码</p>

    <pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span><span class="hljs-params">()</span>:</span>
    lst = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):
        lst.append(<span class="hljs-keyword">lambda</span> x: x * i)
    <span class="hljs-keyword">return</span> lst


lst = test()
[f(<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> lst]
<span class="hljs-comment"># Output: [4, 4, 4, 4, 4]</span>
</code></pre>
<p>在这里中，匿名函数中的变量 <code>i</code> 并没有在声明时便被求值，而是在匿名函数被调用时才被求值。因为 <code>i</code> 来自于 <code>test</code> 函数，且在匿名函数被调用时，循环已经结束，所以 <code>i</code> 的值已经变成 4。</p>
<p>但如果想让 <code>i</code> 在匿名函数声明时便被求值该如何做呢？<br>以下代码便借助默认参数解决问题:</p>

    <pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span><span class="hljs-params">()</span>:</span>
    lst = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">5</span>):
        lst.append(<span class="hljs-keyword">lambda</span> x, i=i: x * i)
    <span class="hljs-keyword">return</span> lst

lst = test()

[f(<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> lst]
<span class="hljs-comment"># Output: [0, 1, 2, 3, 4]</span>
</code></pre>
<p>与第一段代码相比，第二段代码中的 <code>i</code> 在匿名函数声明时就被求值，而且因此，每个匿名函数拥有的默认参数 <code>i</code> 的值都不相同。这样解决了问题。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://github.com/python/cpython/blob/master/Include/funcobject.h" target="_blank" rel="noopener">funcobject.h</a></li>
<li><a href="http://stackoverflow.com/questions/10120974/where-is-the-default-parameter-in-python-function" target="_blank" rel="noopener">Where is the default parameter in Python function</a></li>
<li><a href="http://effbot.org/zone/default-values.htm" target="_blank" rel="noopener">Default Parameter Values in Python</a></li>
</ol>

</template>

  </template>
  <script type="text/javascript">
    window.root = "/"
  </script>
  <script src="/js/manifest.js"></script>
  <script src="/js/vendor.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
